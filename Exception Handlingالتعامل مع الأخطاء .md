# Exception Handlingالتعامل مع الأخطاء

### **ما هي الأخطاء (Exceptions)؟**

**الأخطاء (Exceptions)** هي حالات غير طبيعية تحدث أثناء تنفيذ البرنامج. يمكن أن تكون نتيجة لأسباب متعددة مثل:

- محاولة الوصول إلى ملف غير موجود.
- محاولة تقسيم رقم على صفر.
- الوصول إلى عنصر في قائمة باستخدام فهرس غير صحيح.

عند حدوث خطأ، يمكن للبرنامج إما:

- التوقف عن العمل بشكل مفاجئ (أو يُسمى بالـ **crash**).
- أو التعامل مع الخطأ بطريقة صحيحة باستخدام **التعامل مع الأخطاء (Exception Handling)**.

---

### **التعامل مع الأخطاء باستخدام `try-catch`**

دارت تقدم لنا أدوات للتعامل مع الأخطاء عبر استخدام **`try-catch`** و **`finally`**. هذه الأدوات تتيح لنا **التقاط** الأخطاء عندما تحدث ومعالجتها.

### **1. استخدام `try-catch`**

- **`try`**: الكود الذي يمكن أن يؤدي إلى حدوث خطأ يتم وضعه داخل **`try`**.
- **`catch`**: إذا حدث خطأ داخل الـ **`try`**، يتم **التقاطه** في **`catch`** ويتم تنفيذ الكود داخل **`catch`**.

### **بناء الجملة**

```dart
dart
نسختحرير
try {
  // الكود الذي قد يحدث فيه خطأ
} catch (e) {
  // الكود الذي سيتم تنفيذه إذا حدث خطأ
  // 'e' هو استثناء الخطأ (Exception)
}

```

- **`e`**: هو الكائن الذي يمثل الخطأ (Exception). يمكننا استخدامه للحصول على تفاصيل حول الخطأ.

### **مثال 1**: التعامل مع خطأ بسيط

```dart
dart
نسختحرير
void main() {
  try {
    int result = 10 ~/ 0;  // محاولة تقسيم 10 على صفر
    print(result);
  } catch (e) {
    print("حدث خطأ: $e");
  }
}

```

- في هذا المثال، نحاول تقسيم `10` على `0`، وهو غير ممكن، ولذلك يحدث خطأ من نوع **`IntegerDivisionByZeroException`**.

**الإخراج:**

```

حدث خطأ: tegerDivisionByZeroException

```

---

### **2. استخدام `on` مع `catch`**

يمكنك أيضًا تحديد نوع الخطأ الذي ترغب في معالجته باستخدام الكلمة المفتاحية **`on`**، ثم استخدام **`catch`** لالتقاط الخطأ. هذا يسمح لك بالتعامل مع أنواع معينة من الأخطاء بشكل مخصص.

### **بناء الجملة**

```dart

try {
  // الكود الذي قد يحدث فيه خطأ
} on SpecificException catch (e) {
  // الكود الذي سيتم تنفيذه إذا حدث نوع معين من الخطأ
}

```

### **مثال 2**: التعامل مع أنواع معينة من الأخطاء

```dart

void main() {
  try {
    var result = int.parse("abc");  // محاولة تحويل نص غير قابل للتحويل إلى عدد صحيح
    print(result);
  } on FormatException catch (e) {
    print("خطأ في التنسيق: $e");
  }
}

```

- في هذا المثال، نحاول تحويل نص غير قابل للتحويل إلى عدد صحيح، وهو **`FormatException`**. نستخدم **`on FormatException`** لالتقاط هذا النوع من الأخطاء.

**الإخراج:**

```

خطأ في التنسيق: FormatException: Invalid radix-10 number

```

---

### **3. استخدام `finally`**

الجزء **`finally`** يتم تنفيذه بعد الكود في **`try`** و **`catch`** سواء حدث خطأ أم لا. عادةً ما يُستخدم **`finally`** لتنفيذ العمليات التي يجب أن تتم بغض النظر عن وقوع الخطأ، مثل إغلاق الملفات أو تحرير الموارد.

### **بناء الجملة**

```dart

try {
  // الكود الذي قد يحدث فيه خطأ
} catch (e) {
  // الكود الذي سيتم تنفيذه إذا حدث خطأ
} finally {
  // الكود الذي سيتم تنفيذه في جميع الحالات (حتى لو حدث خطأ أو لا)
}

```

### **مثال 3**: استخدام `finally`

```dart

void main() {
  try {
    var result = 10 ~/ 0;  // محاولة تقسيم 10 على صفر
    print(result);
  } catch (e) {
    print("حدث خطأ: $e");
  } finally {
    print("تم تنفيذ الكود في finally");
  }
}

```

**الإخراج:**

```

حدث خطأ: IntegerDivisionByZeroException
تم تنفيذ الكود في finally

```

- كما ترى، في النهاية يتم تنفيذ الكود داخل **`finally`** بغض النظر عما إذا حدث خطأ أم لا.

---

### **4. تمرير معلومات إضافية عن الخطأ**

في بعض الأحيان، قد ترغب في إرسال معلومات إضافية حول الخطأ، مثل التتبع (stack trace). يمكنك استخدام **`StackTrace`** في **`catch`** للحصول على تفاصيل حول مكان حدوث الخطأ.

### **بناء الجملة**

```dart

try {
  // الكود الذي قد يحدث فيه خطأ
} catch (e, stackTrace) {
  // الكود الذي سيتم تنفيذه إذا حدث خطأ
  // 'stackTrace' يحتوي على معلومات عن مكان الخطأ
}

```

### **مثال 4**: استخدام `StackTrace`

```dart

void main() {
  try {
    var result = int.parse("abc");  // محاولة تحويل نص غير قابل للتحويل إلى عدد صحيح
    print(result);
  } catch (e, stackTrace) {
    print("حدث خطأ: $e");
    print("تفاصيل الخطأ: $stackTrace");
  }
}

```

**الإخراج:**

```

حدث خطأ: FormatException: Invalid radix-10 number
تفاصيل الخطأ: #0      main (file:///path/to/your/file.dart:4:28)

```

- **`stackTrace`** يوفر تفاصيل حول مكان وقوع الخطأ في الشيفرة، مما يساعدك على تحديد مكان الخطأ بدقة أكبر.

---

### **5. إنشاء استثناءات مخصصة (Custom Exceptions)**

يمكنك أيضًا إنشاء أنواع مخصصة من الاستثناءات في دارت، مما يسمح لك بتخصيص الأخطاء التي قد تحدث في برنامجك.

### **بناء الجملة**

```dart

class CustomException implements Exception {
  final String message;
  CustomException(this.message);

  @override
  String toString() => "CustomException: $message";
}

```

### **مثال 5**: إنشاء استثناء مخصص

```dart

class NegativeNumberException implements Exception {
  final String message;
  NegativeNumberException(this.message);

  @override
  String toString() => "NegativeNumberException: $message";
}

void checkPositive(int number) {
  if (number < 0) {
    throw NegativeNumberException("العدد يجب أن يكون موجبًا");
  }
  print("العدد $number هو عدد موجب");
}

void main() {
  try {
    checkPositive(-5);
  } catch (e) {
    print(e);
  }
}

```

**الإخراج:**

```

NegativeNumberException: العدد يجب أن يكون موجبًا

```

- في هذا المثال، قمنا بإنشاء استثناء مخصص يسمى **`NegativeNumberException`**، وألقيناه عندما كان الرقم المدخل سلبيًا.

---

### **الخلاصة**

- **`try-catch`**: يُستخدم لاحتواء الكود الذي قد يتسبب في خطأ والتعامل مع هذا الخطأ.
- **`on`**: يُستخدم لاختيار نوع معين من الأخطاء للتعامل معه.
- **`finally`**: يُستخدم لتنفيذ الكود الذي يجب تنفيذه بغض النظر عن حدوث الخطأ أو لا.
- **`StackTrace`**: يمكن استخدامها للحصول على مزيد من المعلومات حول الخطأ.
- **الاستثناءات المخصصة**: يمكن إنشاؤها لتخصيص الأخطاء الخاصة بك.

التعامل مع الأخطاء هو جزء حيوي من بناء التطبيقات القوية والمستقرة، ويُسهم في ضمان أن التطبيق يمكنه الاستمرار في العمل حتى في حالة حدوث مشكلات.